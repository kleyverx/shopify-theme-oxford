<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Mini Cart</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
        }
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .console-output {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>Test Mini Cart - Diagnóstico</h1>
        
        <div class="test-section">
            <h2>1. Verificar elementos del DOM</h2>
            <button class="test-button" onclick="checkDOMElements()">Verificar elementos</button>
            <div id="dom-output" class="console-output"></div>
        </div>
        
        <div class="test-section">
            <h2>2. Verificar JavaScript</h2>
            <button class="test-button" onclick="checkJavaScript()">Verificar JS</button>
            <div id="js-output" class="console-output"></div>
        </div>
        
        <div class="test-section">
            <h2>3. Simular clic en mini carrito</h2>
            <button class="test-button" onclick="testMiniCartClick()">Probar clic</button>
            <div id="click-output" class="console-output"></div>
        </div>
        
        <div class="test-section">
            <h2>4. Verificar CartAPI</h2>
            <button class="test-button" onclick="checkCartAPI()">Verificar CartAPI</button>
            <div id="api-output" class="console-output"></div>
        </div>
    </div>

    <script>
        function log(elementId, message) {
            const element = document.getElementById(elementId);
            element.textContent += new Date().toLocaleTimeString() + ': ' + message + '\n';
        }
        
        function checkDOMElements() {
            const output = document.getElementById('dom-output');
            output.textContent = '';
            
            const elements = {
                'Mini Cart Wrapper': '.mini-cart-wrapper',
                'Mini Cart Trigger': '[data-mini-cart-trigger]',
                'Mini Cart Dropdown': '#mini-cart-dropdown',
                'Mini Cart Backdrop': '.mini-cart__backdrop',
                'Mini Cart Close Buttons': '[data-mini-cart-close]',
                'Mini Cart Items Container': '#mini-cart-items',
                'Mini Cart Loading': '#mini-cart-loading',
                'Mini Cart Count': '#mini-cart-count',
                'Mini Cart Subtotal': '#mini-cart-subtotal'
            };
            
            for (const [name, selector] of Object.entries(elements)) {
                const element = document.querySelector(selector);
                if (element) {
                    log('dom-output', `✓ ${name}: Encontrado`);
                } else {
                    log('dom-output', `✗ ${name}: NO encontrado (${selector})`);
                }
            }
        }
        
        function checkJavaScript() {
            const output = document.getElementById('js-output');
            output.textContent = '';
            
            // Check if PremiumMiniCart class exists
            if (typeof PremiumMiniCart !== 'undefined') {
                log('js-output', '✓ Clase PremiumMiniCart: Definida');
            } else {
                log('js-output', '✗ Clase PremiumMiniCart: NO definida');
            }
            
            // Check if instance exists
            if (window.PremiumMiniCart && window.PremiumMiniCart.instance) {
                log('js-output', '✓ Instancia PremiumMiniCart: Creada');
                log('js-output', `  - isOpen: ${window.PremiumMiniCart.instance.isOpen}`);
                log('js-output', `  - isAnimating: ${window.PremiumMiniCart.instance.isAnimating}`);
            } else {
                log('js-output', '✗ Instancia PremiumMiniCart: NO creada');
            }
            
            // Check for JavaScript errors
            window.addEventListener('error', function(e) {
                log('js-output', `✗ Error JS: ${e.message} en ${e.filename}:${e.lineno}`);
            });
        }
        
        function testMiniCartClick() {
            const output = document.getElementById('click-output');
            output.textContent = '';
            
            const trigger = document.querySelector('[data-mini-cart-trigger]');
            if (trigger) {
                log('click-output', '✓ Trigger encontrado, simulando clic...');
                try {
                    trigger.click();
                    log('click-output', '✓ Clic ejecutado');
                    
                    // Check if mini cart opened
                    setTimeout(() => {
                        const dropdown = document.getElementById('mini-cart-dropdown');
                        if (dropdown && dropdown.classList.contains('mini-cart__dropdown--open')) {
                            log('click-output', '✓ Mini carrito se abrió correctamente');
                        } else {
                            log('click-output', '✗ Mini carrito NO se abrió');
                        }
                    }, 100);
                } catch (error) {
                    log('click-output', `✗ Error al hacer clic: ${error.message}`);
                }
            } else {
                log('click-output', '✗ Trigger del mini carrito no encontrado');
            }
        }
        
        function checkCartAPI() {
            const output = document.getElementById('api-output');
            output.textContent = '';
            
            if (window.CartAPI) {
                log('api-output', '✓ CartAPI: Disponible');
                log('api-output', `  - Tipo: ${typeof window.CartAPI}`);
                
                // Try to get cart
                try {
                    window.CartAPI.getCart().then(cart => {
                        log('api-output', '✓ getCart() ejecutado exitosamente');
                        log('api-output', `  - Items en carrito: ${cart.item_count || 0}`);
                    }).catch(error => {
                        log('api-output', `✗ Error en getCart(): ${error.message}`);
                    });
                } catch (error) {
                    log('api-output', `✗ Error al llamar getCart(): ${error.message}`);
                }
            } else {
                log('api-output', '✗ CartAPI: NO disponible');
            }
        }
        
        // Auto-run basic checks on load
        window.addEventListener('load', function() {
            setTimeout(() => {
                checkDOMElements();
                checkJavaScript();
            }, 1000);
        });
    </script>
</body>
</html>