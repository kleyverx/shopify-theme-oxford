<section class="marquee-section{% if section.settings.animate_on_scroll %} section-appear{% endif %}" 
         data-section-type="marquee"
         style="--bg-color: {{ section.settings.background_color | default: '#f8f8f8' }};
                --text-color: {{ section.settings.text_color | default: '#333333' }};
                --speed: {{ section.settings.speed | default: 30 }}s;
                --direction: {{ section.settings.direction | default: 'left' }};
                --padding-y: {{ section.settings.padding_y | default: 20 }}px;
                --font-size: {{ section.settings.font_size | default: 24 }}px;
                --font-weight: {{ section.settings.font_weight | default: 600 }};
                --letter-spacing: {{ section.settings.letter_spacing | default: 1 }}px;">
  
  <div class="marquee-container">
    <div class="marquee-track" data-direction="{{ section.settings.direction | default: 'left' }}">
      <div class="marquee-content">
        {% for block in section.blocks %}
          {% case block.type %}
            {% when 'text' %}
              <span class="marquee-item marquee-text" {{ block.shopify_attributes }}>
                {{ block.settings.text | default: 'Texto de marquee' }}
              </span>
            {% when 'separator' %}
              <span class="marquee-item marquee-separator" {{ block.shopify_attributes }}>
                {{ block.settings.separator | default: '•' }}
              </span>
            {% when 'icon' %}
              <span class="marquee-item marquee-icon" {{ block.shopify_attributes }}>
                {% if block.settings.icon_svg != blank %}
                  {{ block.settings.icon_svg }}
                {% else %}
                  ★
                {% endif %}
              </span>
          {% endcase %}
        {% endfor %}
      </div>
      
      <!-- Duplicar contenido para efecto continuo -->
      <div class="marquee-content marquee-duplicate" aria-hidden="true">
        {% for block in section.blocks %}
          {% case block.type %}
            {% when 'text' %}
              <span class="marquee-item marquee-text">
                {{ block.settings.text | default: 'Texto de marquee' }}
              </span>
            {% when 'separator' %}
              <span class="marquee-item marquee-separator">
                {{ block.settings.separator | default: '•' }}
              </span>
            {% when 'icon' %}
              <span class="marquee-item marquee-icon">
                {% if block.settings.icon_svg != blank %}
                  {{ block.settings.icon_svg }}
                {% else %}
                  ★
                {% endif %}
              </span>
          {% endcase %}
        {% endfor %}
      </div>
    </div>
  </div>
</section>

<style>
.marquee-section {
  background-color: var(--bg-color);
  overflow: hidden;
  position: relative;
  width: 100vw;
  margin-left: calc(-50vw + 50%);
  margin-right: calc(-50vw + 50%);
}

.marquee-container {
  padding: var(--padding-y) 0;
  position: relative;
}

.marquee-track {
  display: flex;
  white-space: nowrap;
  will-change: transform;
}

.marquee-content {
  display: flex;
  align-items: center;
  gap: 2rem;
  animation: marqueeLeft var(--speed) linear infinite;
  flex-shrink: 0;
}

.marquee-duplicate {
  animation: marqueeLeft var(--speed) linear infinite;
}

.marquee-track[data-direction="right"] .marquee-content {
  animation: marqueeRight var(--speed) linear infinite;
}

.marquee-item {
  color: var(--text-color);
  font-size: var(--font-size);
  font-weight: var(--font-weight);
  letter-spacing: var(--letter-spacing);
  flex-shrink: 0;
  display: inline-flex;
  align-items: center;
}

.marquee-text {
  text-transform: uppercase;
}

.marquee-separator {
  opacity: 0.6;
  font-size: calc(var(--font-size) * 0.8);
}

.marquee-icon {
  font-size: calc(var(--font-size) * 1.2);
}

.marquee-icon svg {
  width: 1em;
  height: 1em;
  fill: currentColor;
}

/* Animaciones */
@keyframes marqueeLeft {
  0% {
    transform: translateX(0);
  }
  100% {
    transform: translateX(-100%);
  }
}

@keyframes marqueeRight {
  0% {
    transform: translateX(-100%);
  }
  100% {
    transform: translateX(0);
  }
}

/* Pausar animación al hover */
.marquee-section:hover .marquee-content {
  animation-play-state: paused;
}

/* Responsive */
@media (max-width: 768px) {
  .marquee-item {
    font-size: calc(var(--font-size) * 0.8);
  }
  
  .marquee-content {
    gap: 1.5rem;
  }
}

@media (max-width: 480px) {
  .marquee-item {
    font-size: calc(var(--font-size) * 0.7);
  }
  
  .marquee-content {
    gap: 1rem;
  }
}
</style>

<script>
class MarqueeSection {
  constructor(element) {
    this.section = element;
    this.track = this.section.querySelector('.marquee-track');
    this.contents = this.section.querySelectorAll('.marquee-content');
    this.init();
  }

  init() {
    this.setupAccessibility();
    this.handleReducedMotion();
  }

  setupAccessibility() {
    // Agregar atributos de accesibilidad
    this.track.setAttribute('aria-live', 'off');
    this.track.setAttribute('aria-label', 'Texto en movimiento continuo');
  }

  handleReducedMotion() {
    // Respetar preferencias de movimiento reducido
    if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
      this.contents.forEach(content => {
        content.style.animationPlayState = 'paused';
      });
    }
  }

  pause() {
    this.contents.forEach(content => {
      content.style.animationPlayState = 'paused';
    });
  }

  play() {
    this.contents.forEach(content => {
      content.style.animationPlayState = 'running';
    });
  }
}

// Inicializar cuando el DOM esté listo
document.addEventListener('DOMContentLoaded', function() {
  const marqueeElements = document.querySelectorAll('[data-section-type="marquee"]');
  marqueeElements.forEach(element => {
    new MarqueeSection(element);
  });
});
</script>

{% schema %}
{
  "name": "Marquee",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "header",
      "content": "Configuración General"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Color de fondo",
      "default": "#f8f8f8"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Color del texto",
      "default": "#333333"
    },
    {
      "type": "range",
      "id": "padding_y",
      "label": "Espaciado vertical (px)",
      "min": 10,
      "max": 100,
      "step": 5,
      "default": 20
    },
    {
      "type": "checkbox",
      "id": "animate_on_scroll",
      "label": "Animar al hacer scroll",
      "default": false
    },
    {
      "type": "header",
      "content": "Configuración de Texto"
    },
    {
      "type": "range",
      "id": "font_size",
      "label": "Tamaño de fuente (px)",
      "min": 12,
      "max": 60,
      "step": 2,
      "default": 24
    },
    {
      "type": "range",
      "id": "font_weight",
      "label": "Grosor de fuente",
      "min": 300,
      "max": 900,
      "step": 100,
      "default": 600
    },
    {
      "type": "range",
      "id": "letter_spacing",
      "label": "Espaciado entre letras (px)",
      "min": 0,
      "max": 5,
      "step": 0.5,
      "default": 1
    },
    {
      "type": "header",
      "content": "Configuración de Animación"
    },
    {
      "type": "select",
      "id": "direction",
      "label": "Dirección del movimiento",
      "options": [
        {
          "value": "left",
          "label": "Izquierda"
        },
        {
          "value": "right",
          "label": "Derecha"
        }
      ],
      "default": "left"
    },
    {
      "type": "range",
      "id": "speed",
      "label": "Velocidad (segundos)",
      "min": 10,
      "max": 60,
      "step": 5,
      "default": 30,
      "info": "Menor número = más rápido"
    }
  ],
  "blocks": [
    {
      "type": "text",
      "name": "Texto",
      "settings": [
        {
          "type": "text",
          "id": "text",
          "label": "Texto",
          "default": "Tu texto aquí"
        }
      ]
    },
    {
      "type": "separator",
      "name": "Separador",
      "settings": [
        {
          "type": "text",
          "id": "separator",
          "label": "Símbolo separador",
          "default": "•",
          "info": "Ejemplo: • | ★ ◆ ▪"
        }
      ]
    },
    {
      "type": "icon",
      "name": "Icono",
      "settings": [
        {
          "type": "textarea",
          "id": "icon_svg",
          "label": "Código SVG del icono",
          "info": "Pega aquí el código SVG completo"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Marquee",
      "blocks": [
        {
          "type": "text",
          "settings": {
            "text": "BIENVENIDOS"
          }
        },
        {
          "type": "separator"
        },
        {
          "type": "text",
          "settings": {
            "text": "OFERTAS ESPECIALES"
          }
        },
        {
          "type": "separator"
        },
        {
          "type": "text",
          "settings": {
            "text": "ENVÍO GRATIS"
          }
        },
        {
          "type": "separator"
        }
      ]
    }
  ]
}
{% endschema %}