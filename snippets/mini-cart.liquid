<!-- Mini Cart Wrapper -->
<div class="mini-cart-wrapper" data-mini-cart-wrapper 
     data-hide-images="false" 
     data-hide-quantity-controls="false" 
     data-hide-remove-button="false" 
     data-hide-subtotal="false" 
     data-hide-checkout-button="false" 
     data-hide-view-cart-button="false">
  <!-- Trigger Button -->
  <button class="mini-cart__trigger" data-mini-cart-trigger>
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="var(--icon-stroke-width, 1.0)" stroke-linecap="round" stroke-linejoin="round" style="color: var(--nav-link-color, currentColor);">
          <path d="M5 15.8a1.7 1.7 0 1 0 3.4 0 1.7 1.7 0 1 0 -3.4 0"/>
          <path d="M14.2 15.8a1.7 1.7 0 1 0 3.4 0 1.7 1.7 0 1 0 -3.4 0"/>
          <path d="M14.2 14.2H5V2.5H3.3"/>
          <path d="M5 4.2l11.7 0.8l-0.8 5.8H5"/>
        </svg>
    <span class="mini-cart__count" data-mini-cart-count>{{ cart.item_count }}</span>
  </button>

  <!-- Dropdown Panel -->
  <div class="mini-cart__dropdown" data-mini-cart-dropdown data-animation-speed="normal">
    <!-- Backdrop -->
    <div class="mini-cart__backdrop" data-mini-cart-backdrop></div>
    
    <!-- Panel -->
    <div class="mini-cart__panel" data-mini-cart-panel>
      <!-- Header -->
      <div class="mini-cart__header">
        <h3 class="mini-cart__title">Carrito de compras</h3>
        <button class="mini-cart__close" data-mini-cart-close>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="var(--icon-stroke-width, 1.5)" style="color: var(--mini-cart-close-icon-color, currentColor);">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>

      <!-- Content -->
      <div class="mini-cart__content" data-mini-cart-content>
        <!-- Empty Cart State (will be shown/hidden by JavaScript) -->
        <div class="mini-cart__empty" data-mini-cart-empty style="display: {% if cart.item_count == 0 %}block{% else %}none{% endif %}">
          <svg class="mini-cart__empty-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="var(--icon-stroke-width, 1.5)" style="color: var(--mini-cart-text-color, currentColor);">
            <circle cx="9" cy="21" r="1"/>
            <circle cx="20" cy="21" r="1"/>
            <path d="M1 1h4l2.68 13.39a2 2 0 002 1.61h9.72a2 2 0 002-1.61L23 6H6"/>
          </svg>
          <h3>Tu carrito está vacío</h3>
          <p>Agrega algunos productos para comenzar</p>
          <a href="/collections/all" class="mini-cart__empty-btn">Continuar comprando</a>
        </div>
        
        <!-- Cart Items Container (will be populated by JavaScript) -->
        <div class="mini-cart__items" data-mini-cart-items style="display: {% if cart.item_count > 0 %}block{% else %}none{% endif %}">
          {% comment %} Initial server-side rendering {% endcomment %}
          {% for item in cart.items %}
            <div class="mini-cart__item" data-item-key="{{ item.key }}">
              <div class="mini-cart__item-image">
                {% if item.image %}
                  <img src="{{ item.image | image_url: width: 80 }}" alt="{{ item.product.title | escape }}">
                {% else %}
                  <div class="mini-cart__item-placeholder">{{ item.product.title | slice: 0, 2 | upcase }}</div>
                {% endif %}
              </div>
              <div class="mini-cart__item-details">
                <h4 class="mini-cart__item-title">{{ item.product.title }}</h4>
                {% if item.variant.title != 'Default Title' %}
                  <div class="mini-cart__item-variant">{{ item.variant.title }}</div>
                {% endif %}
                {% if item.properties.size > 0 %}
                  <div class="mini-cart__item-properties">
                    {% for property in item.properties %}
                      {% unless property.last == blank %}
                        <div class="mini-cart__property">
                          <span class="mini-cart__property-name">{{ property.first }}:</span>
                          <span class="mini-cart__property-value">{{ property.last }}</span>
                        </div>
                      {% endunless %}
                    {% endfor %}
                  </div>
                {% endif %}
                <div class="mini-cart__item-price">{{ item.final_price | money }}</div>
                <div class="mini-cart__item-quantity">
                  <button class="mini-cart__qty-btn" data-mini-cart-qty-change="-1" data-item-key="{{ item.key }}" data-variant-id="{{ item.variant.id }}">-</button>
                  <input type="number" class="mini-cart__qty-input" value="{{ item.quantity }}" min="1" data-mini-cart-qty-input data-item-key="{{ item.key }}" data-variant-id="{{ item.variant.id }}">
                  <button class="mini-cart__qty-btn" data-mini-cart-qty-change="1" data-item-key="{{ item.key }}" data-variant-id="{{ item.variant.id }}">+</button>
                </div>
              </div>
              <button class="mini-cart__remove-btn" data-mini-cart-remove data-item-key="{{ item.key }}">×</button>
            </div>
          {% endfor %}
        </div>

        {% comment %} Free Shipping Progress {% endcomment %}
        {% assign free_shipping_threshold = 5000 %}
        <div class="mini-cart__free-shipping" data-threshold="{{ free_shipping_threshold }}">
          {% assign remaining = free_shipping_threshold | minus: cart.total_price %}
          {% if remaining > 0 %}
            {% assign progress = cart.total_price | times: 100 | divided_by: free_shipping_threshold %}
            <div class="mini-cart__progress-bar">
              <div class="mini-cart__progress-fill" style="width: {{ progress }}%"></div>
            </div>
            <p class="mini-cart__free-shipping-text">Agrega {{ remaining | money }} más para envío gratis</p>
          {% else %}
            <div class="mini-cart__progress-bar">
              <div class="mini-cart__progress-fill" style="width: 100%"></div>
            </div>
            <p class="mini-cart__free-shipping-text mini-cart__free-shipping-achieved">¡Felicidades! Tienes envío gratis</p>
          {% endif %}
        </div>

        <!-- Cart Footer -->
        <div class="mini-cart__footer">
          <div class="mini-cart__subtotal">
            <span class="mini-cart__subtotal-label">Subtotal:</span>
            <span class="mini-cart__subtotal-amount" data-mini-cart-subtotal>{{ cart.total_price | money }}</span>
          </div>
          <div class="mini-cart__actions">
            <a href="/cart" class="mini-cart__view-cart-btn">Ver carrito</a>
            <button class="mini-cart__checkout-btn" data-mini-cart-checkout>Finalizar compra</button>
          </div>
        </div>
      </div>

      <!-- Loading Overlay -->
      <div class="mini-cart__loading" data-mini-cart-loading style="display: none;">
        <div class="mini-cart__spinner"></div>
        <p>Actualizando carrito...</p>
      </div>

      <!-- Error Messages -->
      <div class="mini-cart__errors" data-mini-cart-errors style="display: none;"></div>
    </div>
  </div>
</div>